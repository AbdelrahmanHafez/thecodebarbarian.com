<html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Testing Client-side JavaScript with Karma | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"/><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"/><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"/><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/><link href="/style/style.css" rel="stylesheet" type="text/css"/><link href="/style/github.css" rel="stylesheet" type="text/css"/><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Testing Client-side JavaScript with Karma"/><meta property="og:url" content="http://www.thecodebarbarian.com/2015/05/08/testing-client-side-javascript-with-karma"/><meta property="og:image" content="http://i.imgur.com/NDZxX2t.png"/><meta property="og:site_name" content="The Code Barbarian"/></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed">rss</a></li></ul></div></div><div id="nav" class="navbar"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#home-nav-mobile" class="btn btn-default navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand big-brand"><img src="/images/Barbarian_Head.png" class="logo"/><span class="site-name">The Code Barbarian  </span></a></div><div id="home-nav-mobile" class="navbar-right collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="/tag/mongodb">MongoDB</a></li><li><a href="/tag/angularjs">AngularJS</a></li><li><a href="/tag/nodejs">NodeJS</a></li><li><a href="/tag/paleo">Paleo</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div id="desktop-right-bar" class="col-lg-3 col-lg-offset-9 right-bar"><div class="right-bar-content-slider pull-right"><div class="row search-container"><div class="col-lg-12"><div class="form-group"></div><label>Search</label><form onsubmit="window.location.href = 'https://www.google.im/search?q=' + encodeURIComponent(document.getElementById('searchQ').value) + '+site:thecodebarbarian.com'; return false;"><div class="input-group"><input id="searchQ" type="text" class="form-control"/><div class="input-group-addon search-button"><i class="fa fa-search"></i></div></div></form></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12"><p class="right-bar-label">All Time Most Popular </p><ul class="list-unstyled"><li class="right-bar-li"><a href="/2013/07/22/introduction-to-the-mean-stack-part-one-setting-up-your-tools/">Introduction to the MEAN Stack, Part One: Setting Up Your Tools</a></li><li class="right-bar-li"><a href="/2013/09/23/the-8020-guide-to-writing-angularjs-directives/">The 80/20 Guide to Writing AngularJS Directives</a></li><li class="right-bar-li"><a href="/2013/07/29/introduction-to-the-mean-stack-part-two-building-and-testing-a-to-do-list/">Introduction to the MEAN Stack, Part Two: Building and Testing a To-do List</a></li><li class="right-bar-li"><a href="/2013/05/12/how-to-easily-validate-any-form-ever-using-angularjs/">How to Easily Validate Any Form Ever Using AngularJS</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12"><p class="right-bar-label">Recent Posts</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/ionic-loopback-testing">Ionic Framework and LoopBack, Part IV: Testing with Travis</a></li><li class="right-bar-li"><a href="/mongodb-gridfs-stream">The MongoDB Node.js Driver's New Streaming GridFS API</a></li><li class="right-bar-li"><a href="/2015/10/09/ionic-loopback-mobile-app">Ionic Framework and LoopBack, Part III: Building an Ionic App</a></li><li class="right-bar-li"><a href="/2015/09/04/ionic-loopback-directives">Ionic Framework and LoopBack, Part II: Directives with the AngularJS LoopBack SDK</a></li></ul></div></div></div></div></div><div id="mobile-sharing-options" class="container-fluid hidden-sm hidden-md hidden-lg"><div class="row"><div class="col-lg-12"><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a href="https://twitter.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F2015%2F05%2F08%2Ftesting-client-side-javascript-with-karma&amp;via=code_barbarian" class="social"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2F2015%2F05%2F08%2Ftesting-client-side-javascript-with-karma" class="social"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2F2015%2F05%2F08%2Ftesting-client-side-javascript-with-karma" class="social"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a href="#disqus_thread" class="social"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div id="desktop-sharing-options" class="post-sharing-options hidden-xs pull-left"><ul class="list-unstyled"><li class="twitter-share"><a href="https://twitter.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F2015%2F05%2F08%2Ftesting-client-side-javascript-with-karma&amp;via=code_barbarian" class="social"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2F2015%2F05%2F08%2Ftesting-client-side-javascript-with-karma" class="social"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2F2015%2F05%2F08%2Ftesting-client-side-javascript-with-karma" class="social"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Testing Client-side JavaScript with Karma </h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">May 08, 2015</span></div></div></div><div class="post-body-text-container"><p><em>This post originally appeared on <a href="https://strongloop.com/strongblog/karma-test-client-side-javascript/">strongloop.com</a>. StrongLoop provides tools and services for companies developing APIs in Node. <a href="http://www.strongloop.com">Learn more...</a></em></p>
<p>I have often quipped that if I were stuck on a desert island with
only one npm module, I&#39;d choose
<a href="https://www.npmjs.com/package/karma">karma</a>.
The one place where you can&#39;t avoid using JavaScript is in the
browser. Even
<a href="http://en.wikipedia.org/wiki/Dart_%28programming_language%29">Dart</a>
needs to be transpiled to JavaScript to work on browsers other than
<a href="https://www.dartlang.org/tools/dartium/">Dartium</a>. And code that
can&#39;t be tested should not be written. Karma is a widely-adopted
command-line tool for testing JavaScript code in real browsers.
It has <a href="https://www.npmjs.com/search?q=karma">myriad plugins</a> that
enable you to write tests using virtually any framework (mocha, 
jasmine, ngScenario, etc.) and run them against a local browser
or in <a href="https://saucelabs.com/">Sauce&#39;s Selenium cloud</a>.</p>
<p>In this article, you&#39;ll see how to use karma to test standalone
JavaScript locally, to test DOM interactions locally, and to run
tests on Sauce Labs. The code for all these examples is available
on
<a href="https://github.com/vkarpov15/karma-demo">my karma-demo GitHub repo</a>.</p>
<h2 id="your-first-karma-test">Your First Karma Test</h2>
<p>Like <a href="https://www.npmjs.com/package/gulp">gulp</a> or
<a href="https://www.npmjs.com/package/metalsmith">metalsmith</a>, karma is
organized as a lightweight core surrounded by a loose confederation
of plugins. Although you will interact with the karma core
executable, you will typically need to install numerous plugins to
do anything useful.</p>
<p>Suppose you have a trivial browser-side JavaScript file like below.
This code is
<a href="https://github.com/vkarpov15/karma-demo/blob/master/lib/sample.js"><code>lib/sample.js</code> in the karma-demo GitHub repo</a></p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">theAnswer</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
}
</code></pre>
<p>Testing this in NodeJS would be fairly simple. But, what if you
wanted to test this in a real browser, like Chrome?
Let&#39;s say you have the
<a href="https://github.com/vkarpov15/karma-demo/blob/master/test/sample.test.js">following test file</a>.</p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'sample'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> {
  it(<span class="hljs-string">'returns 42'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> {
    <span class="hljs-built_in">assert</span>.equal(theAnswer(), <span class="hljs-number">42</span>);
  });
});
</code></pre>
<p>To run this test in Chrome, set up your <code>package.json</code> with
karma and 3 plugins. As you might expect, <code>karma-mocha</code> is
a karma plugin that enables you to use the
<a href="https://www.npmjs.com/package/mocha">mocha test framework</a>, and
<code>karma-chrome-launcher</code> enables karma to launch Chrome locally.
The <code>karma-chai</code> package is a wrapper around the
<a href="https://www.npmjs.com/package/chai"><code>chai</code> assertion framework</a>,
since neither mocha nor karma includes an assertion framework by
default.</p>
<pre><code class="lang-javascript">{
  "<span class="hljs-attribute">devDependencies</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">karma</span>": <span class="hljs-value"><span class="hljs-string">"0.12.31"</span></span>,
    "<span class="hljs-attribute">karma-chai</span>": <span class="hljs-value"><span class="hljs-string">"0.1.0"</span></span>,
    "<span class="hljs-attribute">karma-chrome-launcher</span>": <span class="hljs-value"><span class="hljs-string">"0.1.4"</span></span>,
    "<span class="hljs-attribute">karma-mocha</span>": <span class="hljs-value"><span class="hljs-string">"0.1.10"</span>
  </span>}
</span>}
</code></pre>
<p>Now that you have karma installed, you need a karma config file.
You can run <code>./node_modules/karma/bin/karma init</code> to have karma
initialize one for you, but the
<a href="https://github.com/vkarpov15/karma-demo/blob/master/test/karma.mocha.conf.js">karma config file you&#39;re going to need</a>
is shown below.</p>
<pre><code class="lang-javascript">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(config)</span> </span>{
  config.<span class="hljs-keyword">set</span>({
    <span class="hljs-comment">// Use cwd as base path</span>
    basePath: <span class="hljs-string">''</span>,

    <span class="hljs-comment">// Include mocha test framework and chai assertions</span>
    frameworks: [<span class="hljs-string">'mocha'</span>, <span class="hljs-string">'chai'</span>],

    <span class="hljs-comment">// Include the test and source files</span>
    files: [<span class="hljs-string">'../lib/*.js'</span>, <span class="hljs-string">'./sample.test.js'</span>],

    <span class="hljs-comment">// Use built-in 'progress' reporter</span>
    reporters: [<span class="hljs-string">'progress'</span>],

    <span class="hljs-comment">// Boilerplate</span>
    urlRoot : <span class="hljs-string">'/__karma__/'</span>,
    port: <span class="hljs-number">8080</span>,
    runnerPort: <span class="hljs-number">9100</span>,
    colors: <span class="hljs-literal">true</span>,
    logLevel: config.LOG_INFO,

    <span class="hljs-comment">/* Karma can watch the file system for changes and
     * automatically re-run tests. Making karma do it
     * is more efficient than using gulp because karma
     * can re-use the same browser process. Set this to
     * true and `singleRun` to false to run tests
     * continuously */</span>
    autoWatch: <span class="hljs-literal">false</span>,

    <span class="hljs-comment">// Set the browser to run</span>
    browsers: [<span class="hljs-string">'Chrome'</span>],

    <span class="hljs-comment">// See autoWatch</span>
    singleRun: <span class="hljs-literal">true</span>,

    <span class="hljs-comment">// Consider browser as dead if no response for 5 sec</span>
    browserNoActivityTimeout: <span class="hljs-number">5000</span>
  });
};
</code></pre>
<p>One key feature of the above config file is that karma configs are
NodeJS JavaScript, not just JSON or YAML. You can do file I/O,
access environment variables, and <code>require()</code> npm modules in your
karma configs.</p>
<p>Once you have this config file, you can run karma using the
<code>./node_modules/karma/bin/karma start test/karma.mocha.conf.js</code> 
command. You should see a Chrome browser pop up and output similar 
to what you see below in the shell:</p>
<pre><code>$ ./node_modules/karma/bin/karma start ./test/karma.mocha.conf.js 
WARN [karma]: Port <span class="hljs-number">8080</span> <span class="hljs-operator">in</span> use
INFO [karma]: Karma v0<span class="hljs-number">.12</span><span class="hljs-number">.31</span> server started <span class="hljs-keyword">at</span> <span class="hljs-keyword">http</span>://localhost:<span class="hljs-number">8081</span>/__karma__/
INFO [launcher]: Starting browser Chrome
INFO [Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>)]: Connected <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">socket</span> <span class="hljs-title">NE7VtfIGgPAVbIB8nBIA</span> <span class="hljs-title">with</span> <span class="hljs-title">id</span> <span class="hljs-title">416059</span></span>
Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>): Executed <span class="hljs-number">1</span> <span class="hljs-operator">of</span> <span class="hljs-number">1</span> SUCCESS (<span class="hljs-number">0</span> <span class="hljs-built_in">secs</span> / <span class="hljs-number">0.001</span> secChrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>): Executed <span class="hljs-number">1</span> <span class="hljs-operator">of</span> <span class="hljs-number">1</span> SUCCESS (<span class="hljs-number">0.012</span> <span class="hljs-built_in">secs</span> / <span class="hljs-number">0.001</span> <span class="hljs-built_in">secs</span>)
</code></pre><h2 id="testing-dom-interactions-with-ngscenario">Testing DOM Interactions with ngScenario</h2>
<p>Karma isn&#39;t just useful for testing isolated JavaScript. With
<a href="https://code.angularjs.org/1.2.16/docs/guide/e2e-testing">ngScenario</a>
and the
<a href="https://www.npmjs.com/package/karma-ng-scenario">karma-ng-scenario plugin</a>
you can test DOM interactions against your local server in a
real browser. In this particular example, you will test
interactions with a trivial page. However, ngScenario, as the
name implies, was developed by the AngularJS team to test
AngularJS applications, so you can use karma to test single
page apps too.</p>
<p>Suppose you want to test
<a href="https://github.com/vkarpov15/karma-demo/blob/master/lib/sample.html">the following page</a>,
which uses the <code>sample.js</code> file from the previous section to
display the number &quot;42&quot; on the page.</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/sample.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onLoad</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'content'</span>).innerHTML = theAnswer();
      }
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">body</span> <span class="hljs-attribute">onload</span>=<span class="hljs-value">"onLoad()"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>In order to serve this page and the <code>sample.js</code> file, you need
an HTTP server. You can put together a simple one using
<a href="https://www.npmjs.com/package/express">express</a>
as show below.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();

app.<span class="hljs-keyword">use</span>(express.<span class="hljs-keyword">static</span>(<span class="hljs-string">'./lib'</span>));

app.listen(<span class="hljs-number">3000</span>);
console.log(<span class="hljs-string">'Server listening on 3000'</span>);
</code></pre>
<p>Navigate to <code>http://localhost:3000/sample.html</code> and you should
see the number &quot;42&quot;. Now, let&#39;s set up karma to test this.</p>
<p>In order to use ngScenario with karma, you need to install the
karma-ng-scenario plugin.</p>
<pre><code class="lang-javascript">{
  "<span class="hljs-attribute">dependencies</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">express</span>": <span class="hljs-value"><span class="hljs-string">"4.12.3"</span>
  </span>}</span>,
  "<span class="hljs-attribute">devDependencies</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">karma</span>": <span class="hljs-value"><span class="hljs-string">"0.12.31"</span></span>,
    "<span class="hljs-attribute">karma-chrome-launcher</span>": <span class="hljs-value"><span class="hljs-string">"0.1.4"</span></span>,
    "<span class="hljs-attribute">karma-ng-scenario</span>": <span class="hljs-value"><span class="hljs-string">"0.1.0"</span>
  </span>}
</span>}
</code></pre>
<p>Once you have the karma-ng-scenario plugin, you will need to
create a <a href="https://github.com/vkarpov15/karma-demo/blob/f0094a17f7fbf5b6a3941bd6066030dfbd63ab89/test/karma.ng-scenario.conf.js">slightly modified karma config file</a>.
The <code>git diff</code> between this file and the previous section&#39;s config file <code>karma.mocha.conf.js</code> is shown below.</p>
<pre><code class="lang-javascript"> module.exports = function(config) {
   config.set({
<span class="hljs-label">     basePath:</span> <span class="hljs-string">''</span>,

-    <span class="hljs-string">frameworks:</span> [<span class="hljs-string">'mocha'</span>, <span class="hljs-string">'chai'</span>],
+    <span class="hljs-string">frameworks:</span> [<span class="hljs-string">'ng-scenario'</span>],

-    <span class="hljs-string">files:</span> [<span class="hljs-string">'../lib/*.js'</span>, <span class="hljs-string">'./sample.test.js'</span>],
+    <span class="hljs-string">files:</span> [<span class="hljs-string">'./scenario.test.js'</span>],
<span class="hljs-label">
     reporters:</span> [<span class="hljs-string">'progress'</span>],

     <span class="hljs-string">urlRoot :</span> <span class="hljs-string">'/__karma__/'</span>,

+    <span class="hljs-string">proxies :</span> {
+      <span class="hljs-string">'/'</span>: <span class="hljs-string">'http://localhost:3000'</span>
+    },
+
<span class="hljs-label">     port:</span> <span class="hljs-number">8080</span>,
<span class="hljs-label">     runnerPort:</span> <span class="hljs-number">9100</span>,
<span class="hljs-label">     colors:</span> <span class="hljs-literal">true</span>,
<span class="hljs-label">
     logLevel:</span> config.LOG_INFO,

-    <span class="hljs-string">autoWatch:</span> <span class="hljs-literal">false</span>,
+    <span class="hljs-string">autoWatch:</span> <span class="hljs-literal">true</span>,
<span class="hljs-label">
     browsers:</span> [<span class="hljs-string">'Chrome'</span>],

-    <span class="hljs-string">singleRun:</span> <span class="hljs-literal">true</span>,
+    <span class="hljs-string">singleRun:</span> <span class="hljs-literal">false</span>,

-    <span class="hljs-comment">// 5 sec</span>
-    <span class="hljs-string">browserNoActivityTimeout:</span> <span class="hljs-number">5000</span>
+    <span class="hljs-comment">// 45 sec</span>
+    <span class="hljs-string">browserNoActivityTimeout:</span> <span class="hljs-number">45000</span>
   });
 };
</code></pre>
<p>That&#39;s all you need! Now, start your web server with
<code>node index.js</code> (your web server needs to be running for
ngScenario to work) and run <code>karma start</code> to execute your tests.</p>
<pre><code>$ ./node_modules/karma/bin/karma start test/karma.ng-scenario.conf.js 
WARN [proxy]: proxy <span class="hljs-string">"http://localhost:3000"</span> normalized <span class="hljs-built_in">to</span> <span class="hljs-string">"http://localhost:3000/"</span>
WARN [karma]: Port <span class="hljs-number">8080</span> <span class="hljs-operator">in</span> use
INFO [karma]: Karma v0<span class="hljs-number">.12</span><span class="hljs-number">.31</span> server started <span class="hljs-keyword">at</span> <span class="hljs-keyword">http</span>://localhost:<span class="hljs-number">8081</span>/__karma__/
INFO [launcher]: Starting browser Chrome
INFO [Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>)]: Connected <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">socket</span> <span class="hljs-title">pyFsC9jnnhcbkTXT5y3t</span> <span class="hljs-title">with</span> <span class="hljs-title">id</span> <span class="hljs-title">7382597</span></span>
Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>): Executed <span class="hljs-number">1</span> <span class="hljs-operator">of</span> <span class="hljs-number">1</span> SUCCESS (<span class="hljs-number">0</span> <span class="hljs-built_in">secs</span> / <span class="hljs-number">0.137</span> secChrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>): Executed <span class="hljs-number">1</span> <span class="hljs-operator">of</span> <span class="hljs-number">1</span> SUCCESS (<span class="hljs-number">0.152</span> <span class="hljs-built_in">secs</span> / <span class="hljs-number">0.137</span> <span class="hljs-built_in">secs</span>)
</code></pre><p>The <code>karma.ng-scenario.conf.js</code> file is configured for karma to
automatically re-run tests if any of the loaded files change.
Suppose you changed the test file <code>scenario.test.js</code> to break:</p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'sample.html'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  it(<span class="hljs-string">'displays 42'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    browser().navigateTo(<span class="hljs-string">'/sample.html'</span>);
    <span class="hljs-comment">// This assertion will fail</span>
    expect(element(<span class="hljs-string">'#content'</span>).text()).toBe(<span class="hljs-string">'43'</span>);
  });
});
</code></pre>
<p>Karma will automatically re-run tests and show you the following
output.</p>
<pre><code>INFO [watcher]: Changed <span class="hljs-built_in">file</span> <span class="hljs-string">"/Users/vkarpov/Workspace/karma-demo/test/scenario.test.js"</span>.
Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>) sample.html displays <span class="hljs-number">42</span> FAILED
  expect <span class="hljs-keyword">element</span> <span class="hljs-string">'#content'</span> <span class="hljs-keyword">text</span> toBe <span class="hljs-string">"43"</span>
  /Users/vkarpov/Workspace/karma-demo/test/scenario.test.js:<span class="hljs-number">4</span>:<span class="hljs-number">32</span>: expected <span class="hljs-string">"43"</span> but was <span class="hljs-string">"42"</span>
Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>): Executed <span class="hljs-number">1</span> <span class="hljs-operator">of</span> <span class="hljs-number">1</span> (<span class="hljs-number">1</span> FAILED) (<span class="hljs-number">0</span> <span class="hljs-built_in">secs</span> / <span class="hljs-number">0.121</span> Chrome <span class="hljs-number">42.0</span><span class="hljs-number">.2311</span> (Mac OS X <span class="hljs-number">10.10</span><span class="hljs-number">.3</span>): Executed <span class="hljs-number">1</span> <span class="hljs-operator">of</span> <span class="hljs-number">1</span> (<span class="hljs-number">1</span> FAILED) ERROR (<span class="hljs-number">0.136</span> <span class="hljs-built_in">secs</span> / <span class="hljs-number">0.121</span> <span class="hljs-built_in">secs</span>)
</code></pre><p><strong>Note</strong> the AngularJS team considers <code>ngScenario</code> to be
deprecated in favor of
<a href="https://www.npmjs.com/package/protractor">protractor</a>. However,
I still think ngScenario and karma have a key niche to fill in
terms of testing JavaScript DOM interactions against a local 
server as part of TDD workflow. If you&#39;re interested in working with me to re-imagine how ngScenario should
work, shoot me an email at val [at] karpov [dot] io.</p>
<h2 id="to-the-cloud-">To the Cloud!</h2>
<p>So far, you&#39;ve only tested your code in Chrome. While testing
in Chrome is better than not testing in the browser at all,
it&#39;s far from a complete testing paradigm. Thankfully, there&#39;s
<a href="https://saucelabs.com/">Sauce Labs</a>, a cloud Selenium service that
you can think of as Amazon EC2 for browsers. You can tell Sauce
to start Internet Explorer 6 running on Windows XP and give you
full control over this browser for testing purposes. In order to
get the tests in this section to work, you will have to sign up
for an account with <a href="https://saucelabs.com/">Sauce Labs</a> to get
an API key.</p>
<p>To integrate karma with Sauce, you&#39;re going to need the
karma-sauce-launcher plugin.</p>
<pre><code class="lang-javascript">{
  "<span class="hljs-attribute">dependencies</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">express</span>": <span class="hljs-value"><span class="hljs-string">"4.12.3"</span>
  </span>}</span>,
  "<span class="hljs-attribute">devDependencies</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">karma</span>": <span class="hljs-value"><span class="hljs-string">"0.12.31"</span></span>,
    "<span class="hljs-attribute">karma-chai</span>": <span class="hljs-value"><span class="hljs-string">"0.1.0"</span></span>,
    "<span class="hljs-attribute">karma-chrome-launcher</span>": <span class="hljs-value"><span class="hljs-string">"0.1.4"</span></span>,
    "<span class="hljs-attribute">karma-ng-scenario</span>": <span class="hljs-value"><span class="hljs-string">"0.1.0"</span></span>,
    "<span class="hljs-attribute">karma-mocha</span>": <span class="hljs-value"><span class="hljs-string">"0.1.10"</span></span>,
    "<span class="hljs-attribute">karma-sauce-launcher</span>": <span class="hljs-value"><span class="hljs-string">"0.2.8"</span>
  </span>}
</span>}
</code></pre>
<p>To run the ngScenario test from the previous section on IE9 and
Safari 5 using Sauce, create
<a href="https://github.com/vkarpov15/karma-demo/blob/master/test/karma.sauce.conf.js">another karma config file</a>.
The <code>git diff</code> between this new file and the previous section&#39;s config file is show below.</p>
<pre><code class="lang-javascript">module.exports = function(config) {
+  var customLaunchers = {
+    <span class="hljs-string">sl_safari:</span> {
+      <span class="hljs-string">base:</span> <span class="hljs-string">'SauceLabs'</span>,
+      <span class="hljs-string">browserName:</span> <span class="hljs-string">'safari'</span>,
+      <span class="hljs-string">platform:</span> <span class="hljs-string">'OS X 10.6'</span>,
+      <span class="hljs-string">version:</span> <span class="hljs-string">'5'</span>
+    },
+    <span class="hljs-string">sl_ie_9:</span> {
+      <span class="hljs-string">base:</span> <span class="hljs-string">'SauceLabs'</span>,
+      <span class="hljs-string">browserName:</span> <span class="hljs-string">'internet explorer'</span>,
+      <span class="hljs-string">platform:</span> <span class="hljs-string">'Windows 7'</span>,
+      <span class="hljs-string">version:</span> <span class="hljs-string">'9'</span>
+    }
+  };
+
   config.set({
<span class="hljs-label">     basePath:</span> <span class="hljs-string">''</span>,
<span class="hljs-label">
     frameworks:</span> [<span class="hljs-string">'ng-scenario'</span>],
<span class="hljs-label">
     files:</span> [<span class="hljs-string">'./scenario.test.js'</span>],

-    <span class="hljs-string">reporters:</span> [<span class="hljs-string">'progress'</span>],
+    <span class="hljs-string">reporters:</span> [<span class="hljs-string">'saucelabs'</span>],

     <span class="hljs-string">urlRoot :</span> <span class="hljs-string">'/__karma__/'</span>,

     <span class="hljs-string">proxies :</span> {
       <span class="hljs-string">'/'</span>: <span class="hljs-string">'http://localhost:3000'</span>
     },
<span class="hljs-label">
     port:</span> <span class="hljs-number">8080</span>,
<span class="hljs-label">     runnerPort:</span> <span class="hljs-number">9100</span>,
<span class="hljs-label">     colors:</span> <span class="hljs-literal">true</span>,
<span class="hljs-label">
     logLevel:</span> config.LOG_INFO,

-    <span class="hljs-string">autoWatch:</span> <span class="hljs-literal">true</span>,
+    <span class="hljs-string">autoWatch:</span> <span class="hljs-literal">false</span>,
+
+    <span class="hljs-comment">// Use these custom launchers for starting browsers on Sauce</span>
+    <span class="hljs-string">customLaunchers:</span> customLaunchers,

-    <span class="hljs-string">browsers:</span> [<span class="hljs-string">'Chrome'</span>],
+    <span class="hljs-comment">// start these browsers</span>
+    <span class="hljs-comment">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span>
+    <span class="hljs-string">browsers:</span> Object.keys(customLaunchers),

-    <span class="hljs-string">singleRun:</span> <span class="hljs-literal">false</span>,
+    <span class="hljs-string">singleRun:</span> <span class="hljs-literal">true</span>,

     <span class="hljs-comment">// 45 sec</span>
-    <span class="hljs-string">browserNoActivityTimeout:</span> <span class="hljs-number">45000</span>
+    <span class="hljs-string">browserNoActivityTimeout:</span> <span class="hljs-number">45000</span>,
+
+    <span class="hljs-string">sauceLabs:</span> {
+      <span class="hljs-string">testName:</span> <span class="hljs-string">'Web App E2E Tests'</span>
+    },
   });
 };
</code></pre>
<p>This is all you need to do. Karma handles setting up an SSH
tunnel for you, so the Sauce browser can make real requests to
your local server.</p>
<pre><code>$ env SAUCE_USERNAME=&lt;username here&gt; env SAUCE_ACCESS_KEY=&lt;API key here&gt; ./node_modules/karma/bin/karma start test/karma.sauce.conf.js 
WARN [proxy]: proxy <span class="hljs-string">"http://localhost:3000"</span> normalized <span class="hljs-built_in">to</span> <span class="hljs-string">"http://localhost:3000/"</span>
WARN [karma]: Port <span class="hljs-number">8080</span> <span class="hljs-operator">in</span> use
INFO [karma]: Karma v0<span class="hljs-number">.12</span><span class="hljs-number">.31</span> server started <span class="hljs-keyword">at</span> <span class="hljs-keyword">http</span>://localhost:<span class="hljs-number">8081</span>/__karma__/
INFO [launcher]: Starting browser safari <span class="hljs-number">5</span> (OS X <span class="hljs-number">10.6</span>) <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">SauceLabs</span></span>
INFO [launcher]: Starting browser <span class="hljs-keyword">internet</span> explorer <span class="hljs-number">9</span> (Windows <span class="hljs-number">7</span>) <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">SauceLabs</span></span>
INFO [launcher.sauce]: <span class="hljs-keyword">internet</span> explorer <span class="hljs-number">9</span> (Windows <span class="hljs-number">7</span>) session <span class="hljs-keyword">at</span> <span class="hljs-keyword">https</span>://saucelabs.com/tests/d6d4c7a5eebe493d9e98bc3559106e54
INFO [launcher.sauce]: safari <span class="hljs-number">5</span> (OS X <span class="hljs-number">10.6</span>) session <span class="hljs-keyword">at</span> <span class="hljs-keyword">https</span>://saucelabs.com/tests/<span class="hljs-number">49</span>dc351d56664ecb92a854b37158c1a8
INFO [IE <span class="hljs-number">9.0</span><span class="hljs-number">.0</span> (Windows <span class="hljs-number">7</span>)]: Connected <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">socket</span> <span class="hljs-title">vGbX2IuqZHZEP6rj9Ltx</span> <span class="hljs-title">with</span> <span class="hljs-title">id</span> <span class="hljs-title">56376293</span></span>
INFO [Safari <span class="hljs-number">5.1</span><span class="hljs-number">.9</span> (Mac OS X <span class="hljs-number">10.6</span><span class="hljs-number">.8</span>)]: Connected <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">socket</span> <span class="hljs-title">K7Nfu1zw5yhVOozy9Lty</span> <span class="hljs-title">with</span> <span class="hljs-title">id</span> <span class="hljs-title">49486594</span></span>
TOTAL: <span class="hljs-number">2</span> SUCCESS
INFO [launcher.sauce]: Shutting down Sauce Connect
</code></pre><p><strong>Note</strong> the above example does not use autowatch. This is because,
in my experience, end-to-end tests run on Sauce labs are too slow 
for the type of fast feedback I&#39;d like from the &#39;test on save&#39;
paradigm. These heavy end-to-end tests are
best run through a CI framework like
<a href="http://thecodebarbarian.com/2015/02/13/travis_coveralls">Travis</a> 
or
<a href="http://thecodebarbarian.com/2015/04/10/shippable-an-alternative-take-on-travis">Shippable</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Karma is a powerful and extensible tool for testing client-side
JS, and very much deserves its spot on the
<a href="https://www.npmjs.com/">npm home page</a>. If there&#39;s one npm module
I can&#39;t write JS without, it&#39;s karma. Karma enables you to test
standalone JavaScript or DOM integrations, locally or in the
Sauce Labs cloud. With karma, you have no excuse for half-answers
like &quot;I think so&quot; when your boss asks you if the site works in IE8.</p>
<p><em>Like this article? Chapter 9 of my upcoming book,
<a href="http://www.amazon.com/Professional-AngularJS-Valeri-Karpov/dp/1118832078/">Professional AngularJS</a>,
is a detailed guide to testing AngularJS applications. It includes
more detail about using karma and ngScenario to test AngularJS
applications, as well as protractor.</em></p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/20150508_karma.md">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
  analytics.load("5DErrxzVhprg8sNh8xaiKDR6dNa7yGTI");
  analytics.page()
}}();</script><script type="text/javascript">analytics.track('opened post',
  { title: "Testing Client-side JavaScript with Karma", time: new Date() });
  </script></body></html>